<div *ngIf="hotel" class="hotel-detalle-container">

  <!-- üîô Bot√≥n para volver -->
  <button class="back-button" (click)="volverAResultados()"> ‚Üê Volver a resultados </button>

  <!-- ======================= -->
  <!-- ENCABEZADO DEL HOTEL -->
  <!-- ======================= -->
  <div class="header-section">
    <div class="hotel-info-header">
      <div class="main-info">
        <h1>{{ hotel.nombre }}</h1>
        <p class="location-text">
          <i class="fa-solid fa-location-dot"></i> {{ hotel.pais }}, {{ hotel.ciudad }}
        </p>
        <p class="location-direct">{{ hotel.direccion }}</p>
        <div class="rating-info">
          <p class="rating-text">{{ hotel.estrellas }} / 5</p>
          <span class="estrellas">{{ '‚≠ê'.repeat(hotel.estrellas) }}</span>
        </div>
      </div>

      <div class="price-and-reserve">
        <p *ngIf="precioHotelMostrado !== null" class="price-text">
          {{ precioHotelMostrado | currency:'PEN':'symbol':'1.2-2' }}
          <span class="price-per-night-header">/noche</span>
        </p>
        <p *ngIf="precioHotelMostrado === null" class="price-text text-red-500">
          Precio no disponible
        </p>
        <a class="reserve-button" [routerLink]="[]" fragment="seccion-habitaciones">Reservar</a>
      </div>
    </div>
  </div>

  <!-- ======================= -->
  <!-- IMAGEN PRINCIPAL -->
  <!-- ======================= -->
  <div class="image-gallery">
    <div class="main-image">
      <img 
        *ngIf="hotel.galeria_imagenes && hotel.galeria_imagenes.length > 0; else noImage"
        [src]="hotel.galeria_imagenes[0]"
        alt="Imagen principal de {{ hotel.nombre }}">
      <ng-template #noImage>
        <img src="assets/images/placeholder-hotel.jpg" alt="Sin imagen disponible">
      </ng-template>
    </div>
  </div>

  <!-- ======================= -->
  <!-- DESCRIPCI√ìN -->
  <!-- ======================= -->
  <div class="content-section">
    <div class="summary">
      <h2>Resumen</h2>
      <p *ngIf="hotel.descripcion && hotel.descripcion.length > 0">
        {{ hotel.descripcion }}
      </p>
      <p *ngIf="!hotel.descripcion || hotel.descripcion.length === 0" class="italic text-gray-500">
        No hay un resumen detallado disponible para este hotel.
      </p>
    </div>
  </div>

  <!-- ======================= -->
  <!-- HABITACIONES DISPONIBLES -->
  <!-- ======================= -->
  <div class="available-rooms" id="seccion-habitaciones">
    <h2>Habitaciones disponibles</h2>

    <div *ngIf="habitacionesFiltradas.length === 0" class="no-rooms-message">
      <p>No se encontraron habitaciones que cumplan con los requisitos.</p>
    </div>

    <div *ngFor="let habitacion of habitacionesFiltradas" class="room-card">
      <div class="room-details">
        <h4>{{ habitacion.nombre }}</h4>
        <p>
          <i class="fa-solid fa-user-group"></i>
          Capacidad: {{ habitacion.capacidad_adultos }} adultos / {{ habitacion.capacidad_ninos }} ni√±os
        </p>
        <p>
          Unidades disponibles:
          {{ habitacion.unidades_disponibles || habitacion.cantidad || 0 }}
        </p>
        <p>{{ habitacion.descripcion || 'Sin descripci√≥n disponible.' }}</p>
      </div>

      <div class="room-selection-controls">
        <p class="price-text">
          {{ habitacion.precio_por_noche | currency:'PEN':'symbol':'1.2-2' }}
          <span class="price-per-night">/noche</span>
        </p>
        <div class="quantity-controls">
          <button 
            (click)="actualizarSeleccion(habitacion, -1)" 
            [disabled]="(habitacion.seleccionada ?? 0) === 0"
          > - </button>

          <span>{{ habitacion.seleccionada || 0 }}</span>

          <button 
            (click)="actualizarSeleccion(habitacion, 1)" 
            [disabled]="habitacion.seleccionada! >= (habitacion.unidades_disponibles || habitacion.cantidad || 0)"
          > + </button>
        </div>
      </div>
    </div>
  </div>

  <!-- ======================= -->
  <!-- BOT√ìN FINAL DE RESERVA -->
  <!-- ======================= -->
  <div *ngIf="mostrarBotonReservar" class="final-reserve-section">
    <button class="final-reserve-button" (click)="reservarHotelFinal()">Reservar</button>
  </div>
</div>

<!-- ======================= -->
<!-- MENSAJE DE CARGA -->
<!-- ======================= -->
<div *ngIf="!hotel" class="loading-message">
  <p>Cargando detalles del hotel...</p>
</div>

<!-- üü¢ Formulario emergente de fechas -->
<div *ngIf="mostrarFormularioFechas" class="modal-fechas">
  <div class="contenido-modal">
    <h3>Selecciona tus fechas de estad√≠a</h3>

    <label>Check-in:</label>
    <input
      type="date"
      [min]="fechaMinimaHoy"
      [(ngModel)]="checkInDate"
      (change)="onFechaCheckInChange($event)"
    />

    <label>Check-out:</label>
    <input
      type="date"
      [min]="fechaMinimaCheckOut || fechaMinimaHoy"
      [(ngModel)]="checkOutDate"
      (change)="onFechaCheckOutChange($event)"
    />

    <div class="botones-modal">
      <button (click)="guardarFechas()">Confirmar</button>
      <button (click)="cancelarFormularioFechas()">Cancelar</button>
    </div>
  </div>
</div>

<!-- ======================= -->
<!-- MENSAJE SIN DISPONIBILIDAD -->
<!-- ======================= -->
<div *ngIf="mensajeDisponibilidad" class="sin-disponibilidad">
  <p>{{ mensajeDisponibilidad¬†}}</p>
</div>